---
title: Web API 'Lerini çağıran Daemon uygulamalarını yapılandırma-Microsoft Identity platform | Mavisi
description: Web API 'Lerini (App Configuration) çağıran Daemon uygulamanız için kodu yapılandırmayı öğrenin
services: active-directory
author: jmprieur
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/19/2020
ms.author: jmprieur
ms.custom: aaddev, devx-track-python
ms.openlocfilehash: 3c52d4d80fd3c77cff5e335967fc9d109212ce29
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/30/2021
ms.locfileid: "104578439"
---
# <a name="daemon-app-that-calls-web-apis---code-configuration"></a>Web API 'Lerini çağıran Daemon uygulaması-kod yapılandırması

Web API 'Lerini çağıran Daemon uygulamanız için kodu yapılandırmayı öğrenin.

## <a name="microsoft-libraries-supporting-daemon-apps"></a>Daemon uygulamalarını destekleyen Microsoft kitaplıkları

Aşağıdaki Microsoft kitaplıkları, Daemon uygulamalarını destekler:

[!INCLUDE [active-directory-develop-libraries-daemon](../../../includes/active-directory-develop-libraries-daemon.md)]

## <a name="configure-the-authority"></a>Yetkilendirmeyi yapılandırma

Daemon uygulamaları, temsilci izinleri yerine uygulama izinleri kullanır. Bu nedenle, desteklenen hesap türü herhangi bir kuruluş dizininde veya kişisel Microsoft hesabı (örneğin, Skype, Xbox, Outlook.com) bir hesap olamaz. Bir Microsoft kişisel hesabına yönelik bir Daemon uygulamasına izin vermek için kiracı yöneticisi yoktur. *Kuruluşumdaki hesaplar* veya *herhangi bir kuruluştaki hesaplar*' ı seçmeniz gerekir.

Uygulama yapılandırmasında belirtilen yetkilinin kiralanmalıdır (kiracı KIMLIĞI veya kuruluşunuzla ilişkili bir etki alanı adı belirterek).

Çok müşterili bir araç sağlamak istiyor olsa da,  `common` hizmet, `organizations` hangi kiracının kullanılması gerektiğini güvenilir bir şekilde çıkarmadığı için bu AKıŞA değil, Kiracı kimliği veya etki alanı adı kullanmanız gerekir.

## <a name="configure-and-instantiate-the-application"></a>Uygulamayı yapılandırma ve oluşturma

MSAL kitaplıklarında, istemci kimlik bilgileri (gizli veya sertifika) gizli istemci uygulaması oluşturma parametresi olarak geçirilir.

> [!IMPORTANT]
> Uygulamanız hizmet olarak çalışan bir konsol uygulaması olsa da, bir Daemon uygulaması ise, bir gizli istemci uygulaması olması gerekir.

### <a name="configuration-file"></a>Yapılandırma dosyası

Yapılandırma dosyası şunları tanımlar:

- Birlikte *yetkiyi* oluşturan bulut örneği ve Kiracı kimliği.
- Uygulama kaydından aldığınız istemci KIMLIĞI.
- Bir istemci parolası ya da bir sertifika.

# <a name="net"></a>[.NET](#tab/dotnet)

İşte [*appsettings.jsdosya üzerinde*](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/master/1-Call-MSGraph/daemon-console/appsettings.json) yapılandırma tanımlama örneği. Bu örnek, GitHub 'daki [.NET Core konsol Daemon](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2) kod örneğinden alınmıştır.

```json
{
  "Instance": "https://login.microsoftonline.com/{0}",
  "Tenant": "[Enter here the tenantID or domain name for your Azure AD tenant]",
  "ClientId": "[Enter here the ClientId for your application]",
  "ClientSecret": "[Enter here a client secret for your application]",
  "CertificateName": "[Or instead of client secret: Enter here the name of a certificate (from the user cert store) as registered with your application]"
}
```

Ya da a sağlarsınız `ClientSecret` `CertificateName` . Bu ayarlar dışlamalı.

# <a name="java"></a>[Java](#tab/java)

```Java
 private final static String CLIENT_ID = "";
 private final static String AUTHORITY = "https://login.microsoftonline.com/<tenant>/";
 private final static String CLIENT_SECRET = "";
 private final static Set<String> SCOPE = Collections.singleton("https://graph.microsoft.com/.default");
```

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

[Node.js Daemon örneği](https://github.com/Azure-Samples/ms-identity-javascript-nodejs-console/) için yapılandırma parametreleri bir *. env* dosyasında bulunur:

```Text 
# Credentials
TENANT_ID=Enter_the_Tenant_Info_Here
CLIENT_ID=Enter_the_Application_Id_Here
CLIENT_SECRET=Enter_the_Client_Secret_Here

# Endpoints
AAD_ENDPOINT=Enter_the_Cloud_Instance_Id_Here
GRAPH_ENDPOINT=Enter_the_Graph_Endpoint_Here
```

# <a name="python"></a>[Python](#tab/python)

İstemci gizli dizileri ile gizli bir istemci oluşturduğunuzda, [Python Daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki yapılandırma dosyasında [parameters.js](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/1-Call-MsGraph-WithSecret/parameters.json) aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/<your_tenant_id>",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "secret": "The secret generated by AAD during your confidential app registration",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

Sertifikalarla gizli bir istemci oluşturduğunuzda, [Python Daemon](https://github.com/Azure-Samples/ms-identity-python-daemon) örneğindeki yapılandırma dosyası [parameters.js](https://github.com/Azure-Samples/ms-identity-python-daemon/blob/master/2-Call-MsGraph-WithCertificate/parameters.json) aşağıdaki gibidir:

```Json
{
  "authority": "https://login.microsoftonline.com/<your_tenant_id>",
  "client_id": "your_client_id",
  "scope": [ "https://graph.microsoft.com/.default" ],
  "thumbprint": "790E... The thumbprint generated by AAD when you upload your public cert",
  "private_key_file": "server.pem",
  "endpoint": "https://graph.microsoft.com/v1.0/users"
}
```

---

### <a name="instantiate-the-msal-application"></a>MSAL uygulamasını oluşturma

MSAL uygulamasını oluşturmak için, MSAL paketini ekleyin, başvurusu yapın veya içeri aktarın (dile bağlı olarak).

Oluşturma, istemci gizli dizileri veya sertifikalar (ya da gelişmiş bir senaryo olarak imzalanmış onaylar olarak) kullanıp kullanmayacağınızı bağlı olarak değişir.

#### <a name="reference-the-package"></a>Pakete başvur

Uygulama kodunuzda MSAL paketine başvurun.

# <a name="net"></a>[.NET](#tab/dotnet)

Uygulamanıza [Microsoft. Identity. Client](https://www.nuget.org/packages/Microsoft.Identity.Client) NuGet paketini ekleyin ve ardından `using` kodunuza başvuracak bir yönerge ekleyin.

MSAL.NET ' de, gizli istemci uygulaması arabirim tarafından temsil edilir `IConfidentialClientApplication` .

```csharp
using Microsoft.Identity.Client;
IConfidentialClientApplication app;
```

# <a name="java"></a>[Java](#tab/java)

```java
import com.microsoft.aad.msal4j.ClientCredentialFactory;
import com.microsoft.aad.msal4j.ClientCredentialParameters;
import com.microsoft.aad.msal4j.ConfidentialClientApplication;
import com.microsoft.aad.msal4j.IAuthenticationResult;
import com.microsoft.aad.msal4j.IClientCredential;
import com.microsoft.aad.msal4j.MsalException;
import com.microsoft.aad.msal4j.SilentParameters;
```

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

Paketleri yalnızca `npm install` *package.js* dosyasının bulunduğu klasörde çalıştırarak yüklemelisiniz. Sonra, **msal-node** paketini içeri aktarın:

```JavaScript 
const msal = require('@azure/msal-node');
```

# <a name="python"></a>[Python](#tab/python)

```python
import msal
import json
import sys
import logging
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-secret"></a>Gizli istemci uygulamasını bir istemci gizli anahtarı ile oluşturun

Gizli istemci uygulamasını bir istemci gizli dizisi ile başlatmak için kod aşağıda verilmiştir:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
           .WithClientSecret(config.ClientSecret)
           .WithAuthority(new Uri(config.Authority))
           .Build();
```

, `Authority` Bulut örneği ve KIRACı kimliği için bir birleştirme, örneğin `https://login.microsoftonline.com/contoso.onmicrosoft.com` veya `https://login.microsoftonline.com/eb1ed152-0000-0000-0000-32401f3f9abd` . [Yapılandırma dosyası](#configuration-file) bölümünde gösterilen dosyadaki *appsettings.js* , bunlar `Instance` sırasıyla ve değerleriyle temsil edilir `Tenant` .

Kod örneğinde, önceki kod parçacığı öğesinden alınmıştır, `Authority`  [authenticationconfig](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/ffc4a9f5d9bdba5303e98a1af34232b434075ac7/1-Call-MSGraph/daemon-console/AuthenticationConfig.cs#L61-L70) sınıfındaki bir özelliktir ve şu şekilde tanımlanır:

```csharp
/// <summary>
/// URL of the authority
/// </summary>
public string Authority
{
    get
    {
        return String.Format(CultureInfo.InvariantCulture, Instance, Tenant);
    }
}
```

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromSecret(CLIENT_SECRET);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

```JavaScript

const msalConfig = {
    auth: {
        clientId: process.env.CLIENT_ID,
        authority: process.env.AAD_ENDPOINT + process.env.TENANT_ID,
        clientSecret: process.env.CLIENT_SECRET,
    }
};

const apiConfig = {
    uri: process.env.GRAPH_ENDPOINT + 'v1.0/users',
};

const tokenRequest = {
    scopes: [process.env.GRAPH_ENDPOINT + '.default'],
};

const cca = new msal.ConfidentialClientApplication(msalConfig);
```

# <a name="python"></a>[Python](#tab/python)

```Python
# Pass the parameters.json file as an argument to this Python script. E.g.: python your_py_file.py parameters.json
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential=config["secret"],
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

---

#### <a name="instantiate-the-confidential-client-application-with-a-client-certificate"></a>İstemci sertifikası ile gizli istemci uygulaması örneğini oluşturma

Sertifika ile bir uygulama oluşturmak için aşağıdaki kod aşağıda verilmiştir:

# <a name="net"></a>[.NET](#tab/dotnet)

```csharp
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
    .WithCertificate(certificate)
    .WithAuthority(new Uri(config.Authority))
    .Build();
```
# <a name="java"></a>[Java](#tab/java)

MSAL Java 'da, sertifikalarla gizli istemci uygulaması örneğini oluşturmak için iki oluşturucular vardır:

```Java

InputStream pkcs12Certificate = ... ; /* Containing PCKS12-formatted certificate*/
string certificatePassword = ... ;    /* Contains the password to access the certificate */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(pkcs12Certificate, certificatePassword);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

veya

```Java
PrivateKey key = getPrivateKey(); /* RSA private key to sign the assertion */
X509Certificate publicCertificate = getPublicCertificate(); /* x509 public certificate used as a thumbprint */

IClientCredential credential = ClientCredentialFactory.createFromCertificate(key, publicCertificate);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

Örnek uygulama, şu anda sertifikalarla başlatma gerçekleştirmiyor.

# <a name="python"></a>[Python](#tab/python)

```Python
# Pass the parameters.json file as an argument to this Python script. E.g.: python your_py_file.py parameters.json
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

---

#### <a name="advanced-scenario-instantiate-the-confidential-client-application-with-client-assertions"></a>Gelişmiş senaryo: istemci onaylamaları ile gizli istemci uygulaması örneğini oluşturma

# <a name="net"></a>[.NET](#tab/dotnet)

Gizli istemci uygulaması, bir istemci parolası ya da bir sertifika yerine, istemci onayları kullanarak kimliğini kanıtlayabilirler.

MSAL.NET, gizli istemci uygulamasına imzalı onaylar sağlamak için iki yönteme sahiptir:

- `.WithClientAssertion()`
- `.WithClientClaims()`

Kullandığınızda `WithClientAssertion` , imzalı BIR JWT sağlayın. Bu gelişmiş senaryo, [istemci onaylamaları](msal-net-client-assertions.md)hakkında ayrıntılıdır.

```csharp
string signedClientAssertion = ComputeAssertion();
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithClientAssertion(signedClientAssertion)
                                          .Build();
```

Kullandığınızda `WithClientClaims` , msal.net, Azure AD tarafından beklenen talepleri ve ayrıca göndermek istediğiniz ek istemci taleplerini içeren imzalı bir onaylama işlemi oluşturacaktır.
Bu kod, bunun nasıl yapılacağını gösterir:

```csharp
string ipAddress = "192.168.1.2";
var claims = new Dictionary<string, string> { { "client_ip", ipAddress } };
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
                                          .WithAuthority(new Uri(config.Authority))
                                          .WithClientClaims(certificate, claims)
                                          .Build();
```

Daha ayrıntılı bilgi için bkz. [istemci onayları](msal-net-client-assertions.md).

# <a name="java"></a>[Java](#tab/java)

```Java
IClientCredential credential = ClientCredentialFactory.createFromClientAssertion(assertion);

ConfidentialClientApplication cca =
        ConfidentialClientApplication
                .builder(CLIENT_ID, credential)
                .authority(AUTHORITY)
                .build();
```

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

Örnek uygulama, şu anda onaylarla başlatma gerçekleştirmiyor.

# <a name="python"></a>[Python](#tab/python)

MSAL Python 'da, bu özel anahtar tarafından imzalanacak talepleri kullanarak istemci talepleri sağlayabilirsiniz `ConfidentialClientApplication` .

```Python
# Pass the parameters.json file as an argument to this Python script. E.g.: python your_py_file.py parameters.json
config = json.load(open(sys.argv[1]))

# Create a preferably long-lived app instance that maintains a token cache.
app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential={"thumbprint": config["thumbprint"], "private_key": open(config['private_key_file']).read()},
    client_claims = {"client_ip": "x.x.x.x"}
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache
    )
```

Ayrıntılar için bkz. MSAL Python başvuru belgeleri [ConfidentialClientApplication](https://msal-python.readthedocs.io/en/latest/#msal.ClientApplication.__init__).

---

## <a name="next-steps"></a>Sonraki adımlar

# <a name="net"></a>[.NET](#tab/dotnet)

Bu senaryodaki bir sonraki makaleye geçin, [uygulama için bir belirteç alın](./scenario-daemon-acquire-token.md?tabs=dotnet).

# <a name="java"></a>[Java](#tab/java)

Bu senaryodaki bir sonraki makaleye geçin, [uygulama için bir belirteç alın](./scenario-daemon-acquire-token.md?tabs=java).

# <a name="nodejs"></a>[Node.js](#tab/nodejs)

Bu senaryodaki bir sonraki makaleye geçin, [uygulama için bir belirteç alın](./scenario-daemon-acquire-token.md?tabs=nodejs).

# <a name="python"></a>[Python](#tab/python)

Bu senaryodaki bir sonraki makaleye geçin, [uygulama için bir belirteç alın](./scenario-daemon-acquire-token.md?tabs=python).

---
