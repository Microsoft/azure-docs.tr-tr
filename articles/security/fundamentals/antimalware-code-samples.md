---
title: Azure için Microsoft kötü amaçlı yazılımdan koruma kodu örnekleri | Microsoft Docs
description: Microsoft Antimalware 'i etkinleştirmek ve yapılandırmak için PowerShell kodu örnekleri.
services: security
documentationcenter: na
author: terrylanfear
manager: rkarlin
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.subservice: security-fundamentals
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/01/2021
ms.author: terrylan
ms.openlocfilehash: 8926950d7e152ce0558eeefe68a4df3649f4615d
ms.sourcegitcommit: 3f684a803cd0ccd6f0fb1b87744644a45ace750d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/02/2021
ms.locfileid: "106221952"
---
# <a name="enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms"></a>Azure Resource Manager VM 'Ler için Microsoft Antimalware 'i etkinleştirme ve yapılandırma
Azure Resource Manager VM 'Ler için Microsoft Antimalware 'i etkinleştirebilir ve yapılandırabilirsiniz. Bu makalede PowerShell cmdlet 'leri kullanılarak kod örnekleri sağlanmaktadır.

## <a name="deploy-microsoft-antimalware-on-azure-resource-manager-vms"></a>Azure Resource Manager VM 'lerde Microsoft Antimalware 'i dağıtma

> [!NOTE]
> Bu kod örneğini yürütmeden önce, değişkenlerin açıklamasını ve uygun değerleri sağlamanız gerekir.

```powershell
# Script to add Microsoft Antimalware extension to Azure Resource Manager VMs
# Specify your subscription ID
$subscriptionId= " SUBSCRIPTION ID HERE "
# specify location, resource group, and VM for the extension
$location = " LOCATION HERE " # eg., “Southeast Asia” or “Central US”
$resourceGroupName = " RESOURCE GROUP NAME HERE "
$vmName = " VM NAME HERE "

# Enable Antimalware with default policies
$settingString = ‘{"AntimalwareEnabled": true}’;
# Enable Antimalware with custom policies
# $settingString = ‘{
# "AntimalwareEnabled": true,
# "RealtimeProtectionEnabled": true,
# "ScheduledScanSettings": {
#                             "isEnabled": true,
#                             "day": 0,
#                             "time": 120,
#                             "scanType": "Quick"
#                             },
# "Exclusions": {
#            "Extensions": ".ext1,.ext2",
#                  "Paths":"",
#                  "Processes":"sampl1e1.exe, sample2.exe"
#             },
# "SignatureUpdates": {
#                               "FileSharesSources": “”,
#                               "FallbackOrder”: “”,
#                               "ScheduleDay": 0,
#                               "UpdateInterval": 0,
#                       },
# "CloudProtection": true         
#
# }’;
# Login to your Azure Resource Manager Account and select the Subscription to use
Login-AzureRmAccount
 
Select-AzureRmSubscription -SubscriptionId $subscriptionId
# retrieve the most recent version number of the extension
$allVersions= (Get-AzureRmVMExtensionImage -Location $location -PublisherName “Microsoft.Azure.Security” -Type “IaaSAntimalware”).Version
$versionString = $allVersions[($allVersions.count)-1].Split(“.”)[0] + “.” + $allVersions[($allVersions.count)-1].Split(“.”)[1]
# set the extension using prepared values
# ****—-Use this script till cmdlets address the -SettingsString format issue we observed ****—-
Set-AzureRmVMExtension -ResourceGroupName $resourceGroupName -Location $location -VMName $vmName -Name "IaaSAntimalware" -Publisher “Microsoft.Azure.Security” -ExtensionType “IaaSAntimalware” -TypeHandlerVersion $versionString -SettingString $settingString  
```

## <a name="add-microsoft-antimalware-to-azure-service-fabric-clusters"></a>Azure Service Fabric kümelerine Microsoft Antimalware 'i ekleme
Azure Service Fabric Service Fabric kümelerini oluşturmak için Azure sanal makine ölçek kümelerini kullanır. Şu anda, Service Fabric kümelerini oluşturmak için kullanılan sanal makine ölçek kümeleri şablonu kötü amaçlı yazılımdan koruma uzantısıyla etkinleştirilmemiştir. Bu nedenle, kötü amaçlı yazılımdan koruma, ölçek kümeleri üzerinde ayrı olarak etkinleştirilmelidir. Ölçek kümelerinde etkinleştirdiğinizde, sanal makine ölçek kümeleri altında oluşturulan tüm düğümler devralınır ve uzantıyı otomatik olarak alır.

Aşağıdaki kod örneği, AzureRmVmss PowerShell cmdlet 'lerini kullanarak IaaS kötü amaçlı yazılımdan koruma uzantısını nasıl etkinleştirekullanabileceğinizi gösterir.

> [!NOTE]
> Bu kod örneğini yürütmeden önce, değişkenlerin açıklamasını ve uygun değerleri sağlamanız gerekir.

```powershell
# Script to add Microsoft Antimalware extension to VM Scale Set(VMSS) and Service Fabric Cluster(in turn it used VMSS)
# Login to your Azure Resource Manager Account and select the Subscription to use
Login-AzureRmAccount
# Specify your subscription ID
$subscriptionId="SUBSCRIPTION ID HERE"
Select-AzureRmSubscription -SubscriptionId $subscriptionId
# Specify location, resource group, and VM Scaleset for the extension
$location = "LOCATION HERE" # eg., “West US or Southeast Asia” or “Central US”
$resourceGroupName = "RESOURCE GROUP NAME HERE"
$vmScaleSetName = "YOUR VM SCALE SET NAME"

# Configuration.JSON configuration file can be customized as per MSDN documentation: https://msdn.microsoft.com/en-us/library/dn771716.aspx
$settingString = ‘{"AntimalwareEnabled": true}’;
# Enable Antimalware with custom policies
# $settingString = ‘{
# "AntimalwareEnabled": true,
# "RealtimeProtectionEnabled": true,
# "ScheduledScanSettings": {
#                             "isEnabled": true,
#                             "day": 0,
#                             "time": 120,
#                             "scanType": "Quick"
#                             },
# "Exclusions": {
#            "Extensions": ".ext1,.ext2",
#                  "Paths":"",
#                  "Processes":"sampl1e1.exe, sample2.exe"
#             } ,
# "SignatureUpdates": {
#                               "FileSharesSources": “”,
#                               "FallbackOrder”: “”,
#                               "ScheduleDay": 0,
#                               "UpdateInterval": 0,
#                       },
# "CloudProtection": true         
           
# }’;

# retrieve the most recent version number of the extension
$allVersions= (Get-AzureRmVMExtensionImage -Location $location -PublisherName “Microsoft.Azure.Security” -Type “IaaSAntimalware”).Version
$versionString = $allVersions[($allVersions.count)-1].Split(“.”)[0] + “.” + $allVersions[($allVersions.count)-1].Split(“.”)[1]
$VMSS = Get-AzureRmVmss -ResourceGroupName $resourceGroupName -VMScaleSetName $vmScaleSetName
Add-AzureRmVmssExtension -VirtualMachineScaleSet $VMSS -Name “IaaSAntimalware” -Publisher “Microsoft.Azure.Security” -Type “IaaSAntimalware” -TypeHandlerVersion $versionString
Update-AzureRmVmss -ResourceGroupName $resourceGroupName -Name $vmScaleSetName -VirtualMachineScaleSet $VMSS 
```

## <a name="add-microsoft-antimalware-to-azure-cloud-service-using-extended-support"></a>Genişletilmiş destek kullanarak Azure bulut hizmeti 'ne Microsoft Antimalware ekleme

Aşağıdaki kod örneği, PowerShell cmdlet 'leri aracılığıyla genişletilmiş destek (CS-ES) kullanarak Azure bulut hizmeti 'ne Microsoft Antimalware nasıl ekleyebileceğiniz veya yapılandırabileceğiniz gösterilmektedir.

> [!NOTE]
> Bu kod örneğini yürütmeden önce, değişkenlerin açıklamasını ve uygun değerleri sağlamanız gerekir.

```powershell
# Create Antimalware extension object, where file is the AntimalwareSettings
$xmlconfig = [IO.File]::ReadAllText("C:\path\to\file.xml")
$extension =  New-AzCloudServiceExtensionObject  -Name "AntimalwareExtension" -Type "PaaSAntimalware" -Publisher "Microsoft.Azure.Security" -Setting $xmlconfig -TypeHandlerVersion "1.5" -AutoUpgradeMinorVersion $true

# Get existing Cloud Service
$cloudService = Get-AzCloudService -ResourceGroup "ContosOrg" -CloudServiceName "ContosoCS"

# Add Antimalaware extension to existing Cloud Service extension object
$cloudService.ExtensionProfile.Extension = $cloudService.ExtensionProfile.Extension + $extension

# Update Cloud Service
$cloudService | Update-AzCloudService
```

Özel yapılandırma XML dosyasına bir örnek aşağıdadır

```
<?xml version="1.0" encoding="utf-8"?>
<AntimalwareConfig
    xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
    <AntimalwareEnabled>true</AntimalwareEnabled>
    <RealtimeProtectionEnabled>true</RealtimeProtectionEnabled>
    <ScheduledScanSettings isEnabled="true" day="1" time="120" scanType="Full" />
    <Exclusions>
        <Extensions>
            <Extension>.ext1</Extension>
            <Extension>.ext2</Extension>
        </Extensions>
        <Paths>
            <Path>c:\excluded-path-1</Path>
            <Path>c:\excluded-path-2</Path>
        </Paths>
        <Processes>
            <Process>excludedproc1.exe</Process>
            <Process>excludedproc2.exe</Process>
        </Processes>
    </Exclusions>
</AntimalwareConfig>
```

## <a name="next-steps"></a>Sonraki adımlar
Azure için [Microsoft Antimalware](antimalware.md) hakkında daha fazla bilgi edinin.
